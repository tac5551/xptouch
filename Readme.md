Chrome# XPTouch (XPerimentsTouch) - 3Dプリンター制御システム

## プロジェクト概要

BambuLabプリンター用の高度なタッチスクリーン制御システムです。
直感的なユーザーインターフェースと豊富な機能を提供し、3Dプリンターの操作をより簡単で効率的にします。
このタッチパネルはタッチパネルを持たないBambulabP1Sをターゲットに開発しています。

X1C、X1EおよびA1シリーズ等でも使用可能ではありますが、標準のタッチパネルを持っているため、
追加のメリットがあまりないため、動作確認対象としていません。

P1S Version 1.7以前専用にチューニングをしているため、1.8以降にアップグレードされた個体では使用できません。BambuHandyからダウングレードが必要となります。
（BambuCloud側の制限により閲覧のみとなり操作不能となります。）

## 目次

1. [はじめに](#はじめに)
   - [必要なハードウェア](#必要なハードウェア)
   - [オプションハードウェア](#オプションハードウェア)
   - [xptouchスクリーンの電源供給](#xptouchスクリーンの電源供給)
2. [インストール](#インストール)
   - [Chrome拡張機能のインストール](#chrome拡張機能のインストール)
   - [ファームウェアのインストール](#ファームウェアのインストール)
   - [Bamubulabアカウントとの紐づけ](#bambulabアカウントとの紐づけ)

     - [初回プロビジョニング](#初回プロビジョニング)
     - [トークン更新](#トークン更新)
   - [タッチパネルのキャリブレーション](#タッチパネルのキャリブレーション)
   - [プリンターのリンク](#プリンターのリンク)
   - [Bamubulabアカウントとの紐づけ]()
3. [プリンターへの設置](#bambulab-p1sへの接続)
4. [スクリーン](#スクリーン)
   - [メイン](#メインスクリーン)
   - [温度/ファン](#温度--ファンスクリーン)
   - [制御](#制御スクリーン)
   - [フィラメント](#フィラメントスクリーン)
   - [設定](#設定スクリーン)
5. [アップデート](#アップデート)
   - [OTAアップデート手順](#otaアップデート手順)
   - [SDカードでアップデート](#標準ファームウェアアップデート)
6. [トラブルシューティング](#トラブルシューティング)

## はじめに

xptouchスクリーンは、BambuLabプリンターに革命的な機能を追加し、ユーザーエクスペリエンスを向上させ、高度な制御とモニタリング機能を提供します。
この詳細なREADME.mdガイドでは、製品の機能、インストールプロセス、および各スクリーンの機能について説明します。

### ハードウェア

![image](readme-assets/screen-2-8.png) ![image](readme-assets/screen-2-8-back.png)

現在、手頃な価格のCYD呼ばれる開発ボードで動作するように拡張しています。
用途や入手性に合わせて、選択できます。
各種サポートを進めていますがすべてに対応することは難しいため、2432S028もしくは、JC2432W328Rがいろいろなところから入手可能なため、お勧めです。
2.4および3.2インチのモデルについてはコントローラーが同一のため恐らく使用可能ですが、テストは実施していません。


*推奨ボード(320ｘ240)

| ボード                         | 2432S028R                                             | 2432S028R(USB-C)                                      | JC2432W328R                                           | JC2432W328C                                           | 2432S024                                        | 2432S032                                              |
| ------------------------------ | ----------------------------------------------------- | ----------------------------------------------------- | ----------------------------------------------------- | ----------------------------------------------------- | ----------------------------------------------- | ----------------------------------------------------- |
| サイズ                         | 2.8 inch                                              | 2.8 inch                                              | 2.8 inch                                              | 2.8 inch                                              | 2.4 inch                                        | 3.2 inch                                              |
| 動作確認                       | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`**       | Probably works                                  | Probably works                                        |
| 温度センサー                   | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`** | **`<font color=green>`Yes `</font>`**       |
| ステータスLED<br />NexpixelLED | **`<font color=green>`Yes `</font>`**       | ？？？？                                              | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`**       | **`<font color=green>`Yes `</font>`** | **`<font color=green>`Yes `</font>`**       |
| バッテリ装着                   | No                                                    | No                                                    | **`<font color=green>`Yes `</font>`**       | `<font color=green>`**Yes** `</font>`       | No                                              |                                                       |
| 購入先                         | [購入リンク](https://s.click.aliexpress.com/e/_c3fGqpNT) | [購入リンク](https://s.click.aliexpress.com/e/_c36MHgF7) | [購入リンク](https://s.click.aliexpress.com/e/_c3V5Eyjj) | [購入リンク](https://s.click.aliexpress.com/e/_c3V5Eyjj) |                                                 | [購入リンク](https://s.click.aliexpress.com/e/_c4miViDf) |
| 注意事項                       | 2432S028Cは未確認                                     | ボード手配中<br />LED使用時エラー報告あり             |                                                       |                                                       | 検証予定なし                                    | 検証予定なし                                          |

*推奨ボード(480ｘ320)

| ボード                         | 3248S35C                                                                                                         | 3248S35R                                        | JC3248W535C                                     | JC3248W535R                                     |
| ------------------------------ | ---------------------------------------------------------------------------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |
| サイズ                         | 3.5 inch                                                                                                         | 3.5 inch                                        |                                                 | 3.5 inch                                        |
| 動作確認                       | **`<font color=green>`Yes `</font>`**                                                                  | No                                              |                                                 | Probably works                                  |
| 温度センサー                   | **`<font color=green>`Yes `</font>`**                                                                  | **`<font color=green>`Yes `</font>`** | **`<font color=green>`Yes `</font>`** | **`<font color=green>`Yes `</font>`** |
| ステータスLED<br />NexpixelLED | **`<font color=green>`Yes `</font>`**                                                                  | **`<font color=green>`Yes `</font>`** | **`<font color=green>`Yes `</font>`** | **`<font color=green>`Yes `</font>`** |
| バッテリ装着                   | No                                                                                                               | **No**                                    | **`<font color=green>`Yes `</font>`** | **`<font color=green>`Yes `</font>`** |
| 購入先                         | [購入リンク](https://s.click.aliexpress.com/e/_c3APFetR)<br />[購入リンク](https://s.click.aliexpress.com/e/_c4oUvBW5) |                                                 | 販売終了？                                      | 販売終了？                                      |
| 注意事項                       |                                                                                                                  | 検証中                                          | 検証予定なし                                    | 検証予定なし                                    |

*推奨ボード(800x480)

| ボード                         | JC8048W550                                                                                                       | 8048S043                                              | 8048S050                                              |
| ------------------------------ | ---------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------- | ----------------------------------------------------- |
| サイズ                         | 5.5 inch                                                                                                         | 4.3 inch                                              | 5.0 inch                                              |
| 動作確認                       | **`<font color=green>`Yes`</font>`**                                                                   | Probably works                                        | Probably works                                        |
| 温度センサー                   | **`<font color=green>`Yes`</font>`**                                                                   | **`<font color=green>`Yes`</font>`**        | **`<font color=green>`Yes`</font>`**        |
| ステータスLED<br />NexpixelLED | **`<font color=green>`Yes`</font>`**                                                                   | **`<font color=green>`Yes`</font>`**        | **`<font color=green>`Yes`</font>`**        |
| バッテリ装着                   | **`<font color=green>`Yes`</font>`**                                                                   | No                                                    | No                                                    |
| 購入先                         | [購入リンク](https://s.click.aliexpress.com/e/_okFyaE4) <br />[購入リンク](https://s.click.aliexpress.com/e/_c3GmfL9F) | [購入リンク](https://s.click.aliexpress.com/e/_c3q54KiD) | [購入リンク](https://s.click.aliexpress.com/e/_c4qhBxsZ) |

*制限付き互換ボード

| ボード                            | E32-28T                                               | E32-28T_7789                                          | E32-32T                                               |
| --------------------------------- | ----------------------------------------------------- | ----------------------------------------------------- | ----------------------------------------------------- |
| サイズ                            | 2.8 inch                                              | 2.8 inch                                              | 3.2 inch                                              |
| 動作確認                          | **`<font color=green>`Yes`</font>`**        | **`<font color=green>`Yes`</font>`**        | Probably works                                        |
| 温度センサー                      | Not Support                                           | Not Support                                           | Not Support                                           |
| ステータスLED `<br>`NexpixelLED | Not Support                                           | Not Support                                           | Not Support                                           |
| バッテリ装着                      | **`<font color=green>`Yes`</font>`**        | **`<font color=green>`Yes`</font>`**        | **`<font color=green>`Yes`</font>`**        |
| 購入先                            | [購入リンク](https://s.click.aliexpress.com/e/_c3IEJhcZ) | [購入リンク](https://s.click.aliexpress.com/e/_c3IEJhcZ) | [購入リンク](https://s.click.aliexpress.com/e/_c3IEJhcZ) |

*480ｘ320モデル(動作不可 ※将来的にサポート予定)

| **No.** | 購入元   | ボード名                | サイズ   | 購入リンク                                            |
| ------------- | -------- | ----------------------- | -------- | ----------------------------------------------------- |
| **1**   | Sonton   | 3248S035                | 3.5 inch |                                                       |
| **2**   | GUITION  | 3248S035                | 3.5 inch |                                                       |
| **3**   | GUITION  | JC3248W535              | 3.5 inch | [販売終了]                                            |
| **4**   | IPistBit | ESP-32E(3.5 with touch) | 3.5 inch | [購入リンク](https://s.click.aliexpress.com/e/_c3IEJhcZ) |
| **5**   | IPistBit | ESP-32E(4.0 with touch) | 4.0 inch | [購入リンク](https://s.click.aliexpress.com/e/_c3IEJhcZ) |

*800ｘ480インチモデル (利用不可 対応不可）

| **No.** | 購入元  | ボード名 | サイズ   | 購入リンク                                            |
| ------------- | ------- | -------- | -------- | ----------------------------------------------------- |
| **1**   | GUITION | 8048S070 | 7.0 inch | [購入リンク](https://s.click.aliexpress.com/e/_c4OgPvgh) |

P1sに取り付ける3Dモデルは以下のリンクで見つけることができます
xtouchとかP1touch用に作られてているものがPrintableやMakerWorldに多数あり。

| **No.** | モデル名                                   | リンク                                             |            |
| ------------- | ------------------------------------------ | -------------------------------------------------- | ---------- |
| **1**   | xptouch flip enclosure for Bambu Lab P1P/S | [Printables](https://www.printables.com/model/611634) | 2432R028   |
| **2**   | xptouch flip enclosure for Bambu Lab P1P/S | [MakerWorld](https://makerworld.com/ja/models/920980) | JC8048W550 |

---

### オプションハードウェア

- **[DS18B20温度センサー](docs/temperature-sensor.md)**: チャンバー温度センサーが内蔵されていないプリンターの場合、外部DS18B20温度センサーを追加するオプションがあります。このセンサーは正確なチャンバー温度測定を提供し、xptouchスクリーンの機能を向上させます。スクリーンのコネクターは1.25 MZ JST 4Pです。
- **[NeoPixel LED](https://s.click.aliexpress.com/e/_c4WmQpq5)**: NEOPIXEL LEDリボンを利用して、LEDステータスバーを追加するオプションがあります。ステータスバーは印刷中のステータスに応じて表現されます。

温度センサーは以下のリンクで購入できます：

- [DS18B20 温度センサーB](https://s.click.aliexpress.com/e/_oBYP2pE)
- **DS18B20 P1P/P1Sチャンバー温度エンクロージャー**: さらに、DS18B20温度センサーをP1P/P1Sプリンター内に簡単に統合できる3Dモデルを作成しました。
  3Dモデルは以下のリンクで見つけることができます：`<br>`

  　- [モデルA](https://makerworld.com/en/models/19658) `<br>`
  　`<img src="https://github.com/xperiments-in/xtouch/assets/417709/a8d14564-09e9-4d36-9ad9-10fd8f295c86" width="200"><br>`
  　- [モデルB](https://makerworld.com/en/models/42533) `<br>`
  　`<img src="https://github.com/xperiments-in/xtouch/assets/417709/22871bdf-ba37-44f0-a4b3-33c6352f7f86" width="300">`

---

# セットアップとインストール

このガイドでは、3Dプリンターで使用するためのxptouchスクリーンを初期化および設定するために必要な手順について説明します。
**このプロセスにはGoogle Chromeが必要**です。これは必要なツールと拡張機能をサポートしているためです。

---

## 必要なツールと準備

開始前に、以下を確保してください：

1. **Google Chromeがインストールされたコンピューター**

   - このプロセスには、Google Chromeがインストールされたラップトップまたはデスクトップコンピューターが必要です。
     まだインストールしていない場合は、[https://www.google.com/chrome/](https://www.google.com/chrome/)からChromeをダウンロードしてください。
     
2. **開発環境のセットアップ（ファームウェアのビルドを行う場合）**

   - **Python**: PlatformIOのビルドシステムで使用されます。Python 3.7以上が必要です。
     - [Python公式サイト](https://www.python.org/downloads/)からダウンロードできます。
     - インストール時に「Add Python to PATH」にチェックを入れることを推奨します。
   - **Node.js**: ビルドスクリプトでエラーデータのダウンロードに使用されます。Node.js 14以上が必要です。
     - [Node.js公式サイト](https://nodejs.org/)からLTS版をダウンロードできます。
     - インストール時に自動的にPATHに追加されます。
   - **PlatformIO**: ESP32のファームウェアをビルドするために必要です。
     - VS Codeの拡張機能としてインストールするか、コマンドラインからインストールできます。
     - [PlatformIO公式サイト](https://platformio.org/)を参照してください。
   - **LovyanGFX（tac-lab version）**: グラフィックスライブラリとして使用されます。
     - このプロジェクトには`lib/LovyanGFX`ディレクトリに含まれています。
     - [tac-lab版LovyanGFX](https://github.com/tac5551/LovyanGFX)は、xptouchで使用する各種ボードに対応したカスタマイズ版です。
     - PlatformIOが自動的にこのライブラリを認識して使用します。
   - **esptool（ESP32用ツール）**: ビルド後のファームウェアマージ処理で使用されます。
     - PlatformIOをインストールすると自動的に`~/.platformio/packages/tool-esptoolpy`にインストールされます。
     - ビルドスクリプトで`esptool`コマンドを使用するため、PATHに追加する必要があります。
     - **Windows環境でのPATH設定方法**:
       - システムの環境変数に以下を追加してください：
         ```
         %USERPROFILE%\.platformio\packages\tool-esptoolpy
         ```
       - または、PowerShellで一時的に設定する場合：
         ```powershell
         $env:PATH += ";$env:USERPROFILE\.platformio\packages\tool-esptoolpy"
         ```
     - **Linux/macOS環境でのPATH設定方法**:
       - `~/.bashrc`または`~/.zshrc`に以下を追加：
         ```bash
         export PATH="$HOME/.platformio/packages/tool-esptoolpy:$PATH"
         ```
   - **カスタムボード定義ファイル**: ESP32-S3-DevKitC-1-N16R8ボードを使用する場合、カスタムボード定義ファイルをコピーする必要があります。
     - プロジェクトの`docs/boards/esp32-s3-devkitc1-n16r8.json`をPlatformIOのboardsディレクトリにコピーしてください。
     - **Windows環境でのコピー方法**:
       ```powershell
       Copy-Item "docs\boards\esp32-s3-devkitc1-n16r8.json" "$env:USERPROFILE\.platformio\boards\esp32-s3-devkitc1-n16r8.json"
       ```
     - **Linux/macOS環境でのコピー方法**:
       ```bash
       cp docs/boards/esp32-s3-devkitc1-n16r8.json ~/.platformio/boards/esp32-s3-devkitc1-n16r8.json
       ```
     - コピー後、PlatformIOを再起動するか、新しいターミナルを開いてビルドを実行してください。
   - **注意**: ファームウェアのビルドを行わない場合（事前にビルドされたファームウェアを使用する場合）は、PythonとNode.jsは不要です。
3. **USBケーブル**

   - コンピューターにxptouchスクリーンを接続するための互換性のあるUSBケーブル。
4. **FAT32フォーマットされたSDカード（32GB以下推奨）**

   - **32GB以下**の容量で、FAT32ファイルシステムでフォーマットされたmicroSDカード。
   - 初回セットアップ時にプロビジョニングファイルを転送するために必要です。信頼性の高いSDカードを使用し、問題を避けるために適切にフォーマットされていることを確認してください。
5. **ドライバーのインストール**コンピューターがxptouchスクリーンを認識しない場合、必要なCH340ドライバーをインストールする必要がある場合があります：

   - [CH340ドライバーのダウンロード](https://www.wch.cn/download/CH341SER_ZIP.html)
   - [CH340ドライバーインストールチュートリアル](https://learn.sparkfun.com/tutorials/how-to-install-ch340-drivers/all)
6. **Chromeブラウザ拡張機能**

   - このリンクから**拡張機能をダウンロード**してください：**[Chrome拡張機能のダウンロード](https://tac-lab.tech/xptouch-bin/extensions/xptouch28.zip)**
   - この拡張機能は、初期設定ファイルの生成とxptouchスクリーンのリモート管理に必要です。
   - ダウンロードしたファイルを、ドキュメント内の専用「xptouch」フォルダーやバックアップドライブなどの安全な場所に保存してください。
7. **xptouchオンラインインストーラー**

   - このプラットフォーム毎にインストールURLが異なります。

     **[2.8インチ向け](https://tac-lab.tech/xptouch-bin/2.8/)**
     **[5.5インチ向け](https://tac-lab.tech/xptouch-bin/5.0/)**

**セットアッププロセス中にxptouchスクリーンが信頼性の高い電源に接続されていることを確認してください。**

---

## Chrome拡張機能のインストール

  Chrome拡張機能は、初期設定ファイルの生成とxptouchスクリーンのリモート管理に不可欠なツールです。特にBambuLabトークンは3ヶ月ごとに期限切れになるためです。**オンラインインストーラーを続行する前にインストールする必要があります。インストーラーは完了時にBambuLabにリダイレクトするためです。**

### 拡張機能のダウンロードとインストール

1. **拡張機能のダウンロード**このリンクをクリックしてChrome拡張機能をダウンロードしてください：**[Chrome拡張機能のダウンロード](https://tac-lab.tech/xptouch-bin/extensions/xptouch28.zip)**
2. **拡張機能の安全な保存**

   - ダウンロードした `.zip`ファイルを、ドキュメント内の専用「xptouch」フォルダーやバックアップドライブなどの安全な場所に保存してください。
   - これにより、ファイルが誤って削除されることを防ぎます。
3. **拡張機能の解凍**

   - `.zip`ファイルの内容を安全な場所に解凍してください。
4. **Chromeに拡張機能を追加**

   - **Google Chrome**を開き、**chrome://extensions/**に移動してください。
   - 右上隅のスイッチを切り替えて**開発者モード**を有効にしてください。
   - **パッケージ化されていない拡張機能を読み込む**をクリックし、拡張機能ファイルを解凍したフォルダーを選択してください。
   - 拡張機能がインストールされ、Chromeで表示されるようになります。
5. **簡単なアクセスのための拡張機能のピン留め**

   - Chromeの右上隅にある**拡張機能**アイコン（パズルピース）をクリックしてください。
   - リスト内のxptouch拡張機能を見つけ、その横にある**ピンアイコン**をクリックしてください。
   - 拡張機能がChromeツールバーに表示され、簡単で迅速なアクセスが可能になります。

---

## ファームウェアのインストール

### ステップ1: Google Chromeでオンラインインストーラーを開く

1. コンピューターで**Google Chrome**を開いてください。

   > **注意:** このプロセスでは他のブラウザーはサポートされていません。
   >
2. 以下のURLを入力してインストーラーページに移動してください：

   **[ESP32-2432R028](https://tac-lab.tech/xptouch-bin/2.8/)**
   **[JC8048W550](https://tac-lab.tech/xptouch-bin/5.0/)**

### ステップ2: オンラインインストーラーの使用

1. ウェブページで**「接続」**ボタンをクリックして、コンピューターとxptouchスクリーン間の接続を確立してください。
2. 表示された利用可能なポートのリストから、xptouchスクリーンに割り当てられたシリアルポートを選択してください。
3. 接続後、**「xptouchをインストール」**ボタンをクリックしてインストールプロセスを開始してください。
4. 完了すると、[bambulab.com](https://www.bambulab.com)または[bambulab.cn](https://www.bambulab.cn)にリダイレクトされます。
   > **注意:** プロビジョニングを続行する前に、アカウントにログインしていることを確認してください。
   >

---

## Bambulabアカウントとの紐づけ

xptouchではWifi経由でBambuCloudに接続する為、Wifiの接続設定とBamulabのアカウントと紐詰けが必要です。
初回セットアップ時と3ヶ月ごとに、プロビジョニングする必要があります。

**Chrome拡張機能をする場合、事前に[bambulab.com](https://www.bambulab.com)または[bambulab.cn](https://www.bambulab.cn)にログインしている必要があります。**

---

### 初回プロビジョニング

Chrome拡張機能を初めて開く際は、以下の手順に従ってください：
`<img src="readme-assets/ChromeExtention.png" width="300">`

1. **必要な情報の入力**

   - 拡張機能は以下の詳細の入力を求めます：
     - **SSID**: Wi-Fiネットワーク名。
     - **SSID password**: Wi-Fiパスワード。
     - **Xtouch Lite IP**: これは初回プロビジョニングでデフォルトで `0.0.0.0`に事前設定されており、正しい設定です。これを変更しないでください。
2. **xptouchスクリーンのプロビジョニング**

   - SSIDとパスワードを入力した後、IPを `0.0.0.0`のままにして**「Provision xptouch」**ボタンをクリックしてください。
3. **プロビジョニングファイルのダウンロード**

   - ボタンをクリックした後、**「Download provisioning file」**ボタンが表示されます。
   - リモートプロビジョニングが失敗したことを示すエラーも表示される場合があります。**これは初回プロビジョニングでは正常です。**
   - **「プロビジョニングファイルをダウンロード」**をクリックして `provisioning.json`ファイルをダウンロードしてください。
4. **プロビジョニングファイルの保存と挿入**

   - ダウンロードした `provisioning.json`ファイルをSDカードのルートディレクトリに保存してください。
   - SDカードをxptouchスクリーンに挿入して再起動してください。
5. **接続の確認**

   - 再起動後、すべてが正しく設定されている場合、xptouchスクリーンはWi-FiネットワークとBambuLabサーバーに接続されます。

---

### トークン更新

3ヶ月ごとに、BambuLabトークンが期限切れになると、xptouchスクリーンはトークンデータをクリアします。画面に以下の指示を含むメッセージが表示されます：
**「xxx.xxx.xxx.xxxでプロビジョニング」**
これは、スクリーンが再プロビジョニングを必要としていることを示しています。

#### 再プロビジョニングの手順：

1. **BambuLabにログイン**

   - [bambulab.com](https://www.bambulab.com)または[bambulab.cn](https://www.bambulab.cn)を開き、まだログインしていない場合はアカウントにログインしてください。
2. **Chrome拡張機能を開く**

   - Chrome拡張機能を起動してください。
3. **スクリーンのIPアドレスを入力**

   - xptouchスクリーンに表示されているIPアドレスを拡張機能の**IP**フィールドに入力してください。
4. **xptouchスクリーンのプロビジョニング**

   - **「xptouchをプロビジョニング」**ボタンをクリックしてください。
   - 拡張機能は必要なトークンをxptouchスクリーンに送信します。
5. **自動再起動**

   - 数秒以内に、xptouchスクリーンは新しい設定を適用するために自動的に再起動します。

---

### タッチパネルのキャリブレーション

初回起動時、タッチパネルのキャリブレーションを行う必要があります。
画面の指示にしたがって+が表示されるところをタップしてください

1. **左上をタップ**
2. **右下をタップ**

設定が終わると、touch.jsonに保存されます。
画面が操作できなくなった場合等は、SDカードからtouch.jsonを削除すると再設定が可能です。

---

### プリンターのリンク

初回起動時、Bambuアカウントに複数の3Dプリンターが見つかった場合、使用するプリンタとリンクする必要があります。接続を正常に確立するには、以下の手順に従ってください：

1. **プリンターの検索**:

   - タッチスクリーンの電源を入れた後、「プリンターを検索中」画面が表示されます。タッチスクリーンは利用可能なプリンターをスキャンします。
2. **リンクするプリンターの選択**:

   - スキャンプロセスが完了すると、見つかったプリンターのリストが表示されます。リンクしたいプリンターを選択してください。
3. **チェックマークボタンをクリック**:

   - 希望するプリンターを選択した後、緑のチェックマークボタンをクリックしてリンクプロセスを開始してください。
4. **成功とメインスクリーン**:

   - タッチスクリーンとプリンターのリンクが正常に完了すると、メインスクリーンにリダイレクトされます。プリンターとタッチスクリーンが接続され、使用準備が整います。

これらの手順に従うことで、xptouchスクリーンを3Dプリンターとシームレスにリンクし、スムーズなユーザーエクスペリエンスとタッチスクリーンのすべての機能への簡単なアクセスを確保できます。

---

## Bambulab P1Sへの接続

### xptouchスクリーンの電源供給

xptouchスクリーンは、USBポートで電源供給します。

1. 適切なUSBケーブルをコンピューターまたはUSB電源の利用可能なUSBポートに接続します。
   　**おすすめは、P1Sのコントローラーの背面に用意されているUSB電源ポートへの接続です。**
   　ケーブルを本体内に通す際には、右側にある穴を経由して導入してください。
   　[AMS Rizer](https://makerworld.com/ja/models/647484-ams-airflow-slim-riser-slider-p1p-p1s-x1c#profileId-573815)等を導入済みの方は加工して最短距離の配線も可能です。
   　`<img src="readme-assets/USB_Route.png" width="300"><img src="readme-assets/simple_route.png" width="300">`

---

## スクリーン

### メインスクリーン

- **トップバー**: WiFi、カメラ、タイムラプス、AMSステータスを表示。
- **ライト制御**: プリンターのライトのオン/オフ切り替え。
- **温度インジケーター**: リアルタイムのノズル、ベッド、チャンバー温度インジケーター。
- **ステータスエリア**: タッチスクリーンのステータスエリアは2つの主要な目的を果たします：

  - **アイドル状態**: プリンターが使用されていない場合、「準備完了」メッセージとメインロゴを表示します。
  - **印刷状態**: 印刷中は、一時停止/停止ボタン、プログレスバー、レイヤー情報、リアルタイム制御とモニタリングのための印刷速度セレクターを提供します。

### 温度/ファンスクリーン

このスクリーンでは、各ボタンが特定のセンサーの温度またはファン速度を表す4つのボタンがあります。これらのボタンのいずれかをタップすると、対応する温度または速度値を簡単に調整できる数値キーボード画面に移動します。変更後、簡単なタップで初期画面に戻ることができます。

### 制御スクリーン

このスクリーンは、プリンターを管理するための重要な制御機能を提供します：

- **ホーミング**: プリンターホーミング手順を開始。
- **XYZ位置制御**: プリントヘッドのXYZ位置の精密制御を有効化。
- **ステップサイズ**: より細かいまたは迅速な調整のために、1mmと10mmのヘッド移動増分の間で切り替えることができます。

### フィラメントスクリーン

- **フィラメント処理**: フィラメントのロード、アンロード、押し出し、引き込み（注：フィラメント処理は当初AMSのないプリンターでのみ利用可能）。

### 設定スクリーン

- **LCD**

  - **Back**:
    バックライトの明るさを調整できます。
  - **Sleep**:
    スクリーンのスリープタイマーを調整します。
    指定された時間操作がないと、省電力のためにスリープモードに入ります。0に設定するとスクリーンは点灯したままになります。
  - **Wake On Print**
    印刷開始時に画面がスリープから復帰します。
  - **Wake during Print**
    印字中常に画面が表示されるようになります。手動でのスリープは可能です。
  - **Invert Colors**:
    スクリーン色を反転します。特定のデバイスとの互換性の問題に対処するのに役立ちます。
  - **Flip Screen**:
    スクリーンの向きが上下反転します。電源USBの方向を左右選べます。
- **Chamber LED**

  - **LED Off**
    チャンバーLEDのスリープタイマーを調整します。
    0に設定すると手動でのONOFFが維持されます。
- **OPTIONAL**

  - **Stack Chan Mode**
    スリープ時にスタックチャンが表示されるようになります。
  - **Neopixel**
    - **LEDs**
      接続するNeoPixelの個数を調整できます。0に設定すると制御を行いません。
    - **Blightness**
      LEDバーの明るさを調整できます。
    - **Alarm Timeout**
      印刷完了や、印刷エラー時の表示時間を設定できます。0に設定すると、次の印刷操作をするまで、状態が保持されます。
    - **Idle LED**
      待機状態の時のLEDのOnOffを選べます。Offにすると待機状態でステータスLEDが消灯されます。
- **CONNECTED PRINTERS**

  - **Unlink**
    現在ペアリングされているプリンタの選択を解除します。
    再度プリンタ一覧が表示され、表示するプリンタが再選択できます。
- **XPTOUCH Version**
  現在のXPTouchバージョンが表示されます
- **UPDATE**

  - **OTA Update**
    自動OTAアップデートの有効無効を設定します。有効の場合、電源投入時に、自動的に最新のファームウェアが適用されます。
  - **UPDATE Now**
    任意のタイミングでOTAアップデートを実行します。OTA UpdateがOffの場合でもアップデート可能です。
- **Reboot Device**
  デバイスが再起動されます。

---

## アップデート

### OTAアップデート手順

xptouchスクリーンはオーバー・ザ・エア（OTA）ファームウェアアップデートをサポートしており、最新の機能と改善でデバイスを最新の状態に保つことが簡単になります。
OTAアップデートを実施するには以下の手順に従ってください：

1. **設定スクリーンにアクセス**:

   - xptouchスクリーンで設定スクリーンに移動してください。
2. **手動アップでード**

   - 設定スクリーンで、UpdateNowを押すと、最新のファームウェアをチェックして適用します。
     OTAUpdateが無効の状態でも、任意のタイミングで適用することができます。
3. **OTAアップデート**:

   - 設定スクリーンで、OTA UPDATEを有効にすると。起動時に自動的にアップデートを適用することができます
   - アップデートが利用可能な場合、タッチスクリーンは最新のファームウェアを自動的にダウンロードしてアップグレードを適用します。

### SDファームウェアアップデート

OTAアップデートが利用できない場合、SDカード経由でのアップデートが可能です
手動でアップデートしたい場合、この手順に従ってください：

1. **アップデートファームウェアファイルのダウンロード**:

   - 公式xptouchサイトまたは指定されたファームウェアアップデートソースにアクセスして、最新のファームウェアアップデートファイルをダウンロードしてください。[firmware.bin](https://tac-lab.tech/xptouch-bin/2.8/fw/firmware.bin)という名前でこのファイルをダウンロードしてください。
2. **ファームウェアファイルをSDカードのルートにコピー**:

   - SDカードをコンピューターのカードリーダーに挿入してください。
   - ダウンロードしたファームウェアアップデートファイル[firmware.bin](https://tac-lab.tech/xptouch-bin/2.8/fw/firmware.bin)をSDカードのルートディレクトリにコピーしてください。サブディレクトリには配置しないでください。
3. **xptouchスクリーンの再起動**:

   - ファームウェアアップデートファイルを含むSDカードを、まだ挿入されていない場合はxptouchスクリーンに挿入してください。
   - タッチスクリーンを再起動してください。電源を切ってから再度電源を入れることで実行できます。
4. **ファームウェアアップデートの適用**:

   - タッチスクリーンが起動すると、SDカード上のファームウェアアップデートファイルの自動的に検出します。
   - タッチスクリーンはファームウェアアップデートを適用します。ダウングレードも可能です。
   - アップデートプロセスは完了まで数分かかる場合があります。この間はタッチスクリーンの電源を切ったり、SDカードを削除したりしないでください。
5. **完了と確認**:

   - ファームウェアアップデートが正常に適用された後、タッチスクリーンはアップデートが完了したことを通知します。
   - タッチスクリーンの設定セクションでファームウェアバージョンを確認し、最新バージョンと一致していることを確認できます。

これらの手順に従うことで、xptouchスクリーンのファームウェアを最新バージョンに手動でアップデートし、最新の機能と改善にアクセスできるようになります。

---

## トラブルシューティング

BambuLabプリンタータッチスクリーンのインストールまたは操作中に問題が発生した場合、以下のトラブルシューティング手順を参照して、一般的な問題を解決できます：

1. **データケーブルの使用**:

   - インストールプロセス中にタッチスクリーンをコンピューターに接続する際は、データケーブル（充電ケーブルだけでなく）を使用していることを確認してください。適切な通信にはデータケーブルが必要です。
2. **SDカードの互換性**:

   - 異なるメーカーのSDカードは動作が異なる場合があることに注意してください。多くのSDカードはシームレスに動作しますが、一部はタッチスクリーンと完全に互換性がない場合があります。SDカードで問題が発生した場合は、問題が解決するかどうかを確認するために、異なるブランドやモデルを試してみることを検討してください。
3. **WiFi接続ループ**:

   - 場合によっては、WiFi認証情報が正しいことを確認した後、デバイスが接続を確立せずに連続ループに入ることを報告するユーザーがいます。この問題は、WiFi接続タイムアウトを調整することで解決できる場合があります。
   - これを行うには、`config.json`ファイルを修正し、タイムアウトの数値パラメーターを含めてください。タイムアウト値を増やすことで、この問題に対処できます。
   - ステップバイステップの手順については、[オンラインconfig.jsonフォーム](https://tac-lab.tech/xptouch-bin/config.html)を使用してください。
4. **プリンター起動時の無限再起動**:

   - 場合によっては、プリンターとxptouchスクリーンがデバイスの電源投入プロセス中に無限再起動サイクルを経験し、xptouchが準備完了状態にならない問題が発生する場合があります。この問題は、`config.json`設定ファイル内の「coldboot」値を調整することで解決できる場合がよくあります。
   - この問題に対処するには、`config.json`ファイルを開き、「coldboot」パラメーターの数値パラメーターを含めてください。このパラメーターは、コールドブート後の初期化のためにシステムが待機する時間をミリ秒で指定します。「coldboot」値を増やすことで、システムに起動プロセスを正常に完了するためのより多くの時間を提供します。
   - ステップバイステップの手順については、[オンラインconfig.jsonフォーム](https://tac-lab.tech/xptouch-bin/config.html)を使用してください。
5. **スクリーンの再キャリブレーション**:

   タッチスクリーンのキャリブレーション問題や位置ずれが発生した場合、SDカードの `xptouch`ディレクトリにある `touch.json`ファイルを削除することでスクリーンを再キャリブレーションできます。以下の手順に従ってください：

   - xptouchスクリーンの電源を切ってください。
   - タッチスクリーンからSDカードを削除してください。
   - SDカードをコンピューターに挿入してください。
   - SDカード上の `xptouch`ディレクトリに移動してください。
   - `touch.json`ファイルを削除してください。
   - コンピューターからSDカードを安全に取り出してください。
   - SDカードをタッチスクリーンに再挿入してください。
   - タッチスクリーンの電源を入れてください。

   タッチスクリーンは起動時に自動的に再キャリブレーションプロセスを実行します。

---

## 重要なクレジット表示

XPTouchは、xptouchを源流とした日本語カスタマイズバージョンです。
**本プロジェクトは以下のオープンソースプロジェクトから派生しています：**

### プロジェクト名称

- **XPTouch** - 日本語コミュニティバージョン
- **開発者**: tac-lab.tech
- **ライセンス**: GPLv3

### オリジナルプロジェクト

- **xtouch** - [https://github.com/xperiments-in/xtouch](https://github.com/xperiments-in/xtouch)
- **開発者**: Pedro Casaubon Aguilar
- **ライセンス**: GPLv3 

## 法的免責事項

- 本プロジェクトは教育・研究目的で開発されています
- Bambulab Cloudを利用したサービスのため、提供元の仕様変更などにより使用できなくなる可能性があります。
- このプロジェクトはXTOUCHの拡張を行い、ボード対応を追加していますが、すべての機能の動作を保証するものではありません。
- 参照元プロジェクトの制限によりXPtouchの商用利用は全面的に禁止します。
- オリジナルプロジェクトの開発者には問い合わせしないでください


## References

画面がうまく表示ができない場合はボードを提供いただけると
対応するかも！
[LovyanGFX](https://github.com/tac5551/LovyanGFX)
[OpenBambuAPI](https://github.com/tac5551/OpenBambuAPI)
[ha-bambulab](https://github.com/tac5551/ha-bambulab)
[Bambu-Lab-Cloud-API](https://github.com/tac5551/Bambu-Lab-Cloud-API)

---

**注意**: 本プロジェクトは教育・研究目的で開発されています。

